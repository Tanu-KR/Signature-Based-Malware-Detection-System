from flask import Flask, request, render_template
import sqlite3
import os

app = Flask(__name__)

def connect_db():
    conn = sqlite3.connect('malware_signatures.db')
    return conn

def get_signatures(conn):
    cursor = conn.cursor()
    cursor.execute("SELECT signature, malware_name FROM signatures")
    return cursor.fetchall()

def scan_file(file_path, signatures):
    with open(file_path, 'rb') as file:
        file_content = file.read()
        for signature, malware_name in signatures:
            if signature.encode() in file_content:
                return malware_name
    return None

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/scan', methods=['POST'])
def scan():
    uploaded_file = request.files['file']
    file_path = f'uploads/{uploaded_file.filename}'
    uploaded_file.save(file_path)
    
    conn = connect_db()
    signatures = get_signatures(conn)
    
    malware_detected = scan_file(file_path, signatures)
    
    conn.close()
    
    return render_template('result.html', malware=malware_detected)

if __name__ == "__main__":
    if not os.path.exists('uploads'):
        os.makedirs('uploads')
    app.run(debug=True)
